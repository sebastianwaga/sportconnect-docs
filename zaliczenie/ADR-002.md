# ADR-002: Wybór bazy danych
- **Status:** Zaakceptowana
- **Data:** 2025-10-17
- **Autorzy:** Sebastian Waga, Michał Żmuda, Szymon Rogula, Adam Rudziewicz

---

## 1. Kontekst

Nasza aplikacja wymaga przechowywania wielu typów danych: profili użytkowników wraz z ich lokalizacją geograficzną i preferencjami, kategorii sportowych i przypisań użytkowników do sportów, zapytań o wspólne treningi, logów akcji systemowych oraz tokenów resetowania hasła. Kluczowym wymaganiem funkcjonalnym jest **wyszukiwanie geograficzne** - użytkownicy muszą mieć możliwość znajdowania innych użytkowników w określonym promieniu od swojej aktualnej lokalizacji, co wymaga wydajnych operacji na danych przestrzennych.

---

## 2. Rozważane opcje

### Opcja 1: PostgreSQL + PostGIS

- **Zalety:**
  - [+] Natywne wsparcie dla typów geograficznych (POINT, GEOGRAPHY)
  - [+] Wydajne indeksy przestrzenne (GiST, SP-GiST)
  - [+] Funkcje ST_DWithin, ST_Distance dla zapytań o promień
  - [+] Dojrzały, stabilny system RDBMS z pełnym wsparciem ACID
  - [+] Świetna integracja z Entity Framework Core przez Npgsql

- **Wady:**
  - [-] Wymaga instalacji rozszerzenia PostGIS
  - [-] Większa złożoność konfiguracji niż MySQL

### Opcja 2: MySQL/MariaDB

- **Zalety:**
  - [+] Prostota instalacji i konfiguracji
  - [+] Szeroka dostępność hostingu w różnych cenach

- **Wady:**
  - [-] Słabsze wsparcie dla operacji geograficznych
  - [-] Mniej zaawansowane indeksy przestrzenne niż PostGIS

### Opcja 3: MongoDB

- **Zalety:**
  - [+] Elastyczny schemat ułatwiający iterację nad modelem danych
  - [+] Wbudowane indeksy geolokalizacyjne

- **Wady:**
  - [-] Transakcje ACID mniej naturalne niż w relacyjnych bazach
  - [-] Słabsza integracja z Entity Framework (brak pełnego LINQ)
---

## 3. Decyzja

Wybieramy **PostgreSQL z rozszerzeniem PostGIS** jako bazę danych.

---

## 4. Uzasadnienie

Wybraliśmy PostgreSQL z PostGIS, ponieważ wymaganie wyszukiwania użytkowników w promieniu geograficznym jest absolutnie kluczowe dla głównej funkcjonalności aplikacji. PostGIS oferuje najbardziej zaawansowane funkcje GIS wśród relacyjnych baz danych, w tym wydajne indeksy przestrzenne i funkcje do obliczania odległości. Npgsql.EntityFrameworkCore.PostgreSQL zapewnia pełną, natywną integrację z EF Core, co umożliwia efektywne wykorzystanie LINQ do konstruowania zapytań geograficznych. Użytkownicy przechowują w profilu współrzędne geograficzne (Latitude, Longitude) oraz promień wyszukiwania (SearchRadiusKm), które będą intensywnie wykorzystywane w funkcji matchowania użytkowników.

---

## 5. Konsekwencje

### Pozytywne

- [+] Wydajne zapytania geograficzne dla funkcji matchowania użytkowników dzięki indeksom przestrzennym
- [+] Możliwość wykorzystania zaawansowanych funkcji PostGIS (ST_DWithin, ST_Distance, ST_Buffer)
- [+] Transakcje ACID zapewniające pełną spójność danych w krytycznych operacjach
- [+] Łatwe migracje i zarządzanie schematem przez EF Core Migrations

### Negatywne

- [-] Wymaga dockeryzacji lub instalacji PostgreSQL + PostGIS lokalnie na maszynach deweloperskich
- [-] Większa złożoność deploymentu niż w przypadku SQLite lub prostych baz danych
- [-] Konieczność nauki specyficznych funkcji PostGIS przez członków zespołu
